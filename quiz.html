<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Quiz App</title>

    <link rel="stylesheet" href="styles.css">

</head>

<body>

    <div id="auth-container">

        <h1>Login / Register</h1>

        <input type="email" id="email" placeholder="Email" required>

        <input type="password" id="password" placeholder="Password" required>

        <button id="login-btn">Login</button>

        <button id="register-btn">Register</button>

    </div>

    

    <div id="quiz-container" style="display:none;">

        <div id="question-container"></div>

        <div id="time"></div>

        <button id="previous-question">Previous</button>

        <button id="next-question">Next</button>

        <button id="submit-quiz" style="display:none;">Submit</button>

    </div>

    

    <div id="result-container" style="display:none;">

        <h2>Quiz Results</h2>

        <div id="results"></div>

        <button id="retry-quiz">Retry Quiz</button>
    </div>

    

    <div id="admin-dashboard" style="display:none;">

        <h1>Admin Dashboard</h1>

        <button id="view-results">View Results</button>

        <div id="admin-results"></div>

    </div>

    

    <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-auth.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore.js"></script>

    <script type="module" src="app.js"></script>

</body>

</html>

body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f5f5f5;
}

#auth-container, #quiz-container, #result-container, #admin-dashboard, #view-results {
    padding: 20px;
    margin: 20px auto;
    max-width: 800px;
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
}

input {
    display: block;
    margin: 10px 0;
    padding: 10px;
    width: calc(100% - 22px);
    box-sizing: border-box;
    border-radius: 4px;
    border: 1px solid #ddd;
}

button {
    display: block;
    margin: 10px 0;
    padding: 10px;
    width: calc(100% - 22px);
    box-sizing: border-box;
    border-radius: 4px;
    border: none;
    background-color: #007bff;
    color: #fff;
    font-size: 16px;
    cursor: pointer;
}

button:hover {
    background-color: #0056b3;
}

#question-container {
    margin-bottom: 20px;
}

.option {
    cursor: pointer;
    padding: 10px;
    border: 2px solid #ddd;
    margin-bottom: 5px;
    border-radius: 4px;
    background-color: #f9f9f9;
}

.option.selected {
    background-color: #d0f0c0;
}

.option.correct {
    border-color: #28a745;
    background-color: #c0f0c0;
}

.option.incorrect {
    border-color: #dc3545;
    background-color: #f0c0c0;
}

.result-item {
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 4px;
}

.result-item.correct {
    background-color: #c0f0c0;
    border: 1px solid #28a745;
}

.result-item.incorrect {
    background-color: #f0c0c0;
    border: 1px solid #dc3545;
}

.admin-result-item, .admin-user-item {
    margin-bottom: 20px;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
}





import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.11/firebase-app.js';
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.6.11/firebase-auth.js';
import { getFirestore, collection, getDocs, addDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore.js';

// Firebase configuration
const firebaseConfig = {
    apiKey: "AIzaSyAolcB_o6f1CQPbLSYrMKTYaz_xYs54khY",
    authDomain: "quizapp-1ae20.firebaseapp.com",
    projectId: "quizapp-1ae20",
    storageBucket: "quizapp-1ae20.appspot.com",
    messagingSenderId: "626886802317",
    appId: "1:626886802317:web:df08c307697ca235c45bc4",
    measurementId: "G-NKJTC5C1XW"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let quizData = [];
let userAnswers = {};
let currentQuestionIndex = 0;
let timer;
const TIME_PER_QUESTION = 60; // 1 minute per question
let timeLeft = TIME_PER_QUESTION;

// Event listeners for authentication
document.getElementById('login-btn').addEventListener('click', () => {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    signInWithEmailAndPassword(auth, email, password)
        .then(userCredential => {
            const user = userCredential.user;
            handleUserRedirect(user);
        })
        .catch(error => {
            alert('Login Failed: ' + error.message);
        });
});

document.getElementById('register-btn').addEventListener('click', () => {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    createUserWithEmailAndPassword(auth, email, password)
        .then(async userCredential => {
            const user = userCredential.user;
            await addDoc(collection(db, 'users'), {
                email: user.email,
                name: prompt('Please enter your name:')
            });
            alert('Registration successful! Please login.');
        })
        .catch(error => {
            alert('Registration Failed: ' + error.message);
        });
});

// Redirect user based on role
function handleUserRedirect(user) {
    if (user.email === 'waheedchalla@gmail.com') {
        document.getElementById('admin-dashboard').style.display = 'block';
        document.getElementById('quiz-container').style.display = 'none';
        document.getElementById('auth-container').style.display = 'none';
        document.getElementById('result-container').style.display = 'none';
        document.getElementById('view-results').style.display = 'none'; // Hide View Results button for admin
        loadAdminData();
    } else {
        document.getElementById('auth-container').style.display = 'none';
        document.getElementById('quiz-container').style.display = 'block';
        document.getElementById('result-container').style.display = 'none';
        startQuiz();
    }
}

// Start the quiz and load questions
function startQuiz() {
    userAnswers = {};
    quizData = [];
    currentQuestionIndex = 0;
    document.getElementById('question-container').innerHTML = '';

    loadQuizData();
}

// Load quiz data from Firestore
async function loadQuizData() {
    const querySnapshot = await getDocs(collection(db, 'questions'));
    querySnapshot.forEach(doc => {
        quizData.push({
            id: doc.id,
            ...doc.data()
        });
    });
    renderQuestion();
}

// Render the current question to the DOM
function renderQuestion() {
    const question = quizData[currentQuestionIndex];
    const questionContainer = document.getElementById('question-container');
    questionContainer.innerHTML = `
        <h2>${currentQuestionIndex + 1}. ${question.question}</h2>
        ${question.options.map(option => `
            <div class="option" data-id="${question.id}" data-option="${option}">
                ${option}
            </div>
        `).join('')}
    `;

    document.querySelectorAll('.option').forEach(option => {
        option.addEventListener('click', (e) => {
            const selectedOption = e.target.dataset.option;
            userAnswers[question.id] = selectedOption;
            document.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('selected');
            });
            e.target.classList.add('selected');
        });
    });

    document.getElementById('previous-question').style.display = currentQuestionIndex === 0 ? 'none' : 'block';
    document.getElementById('next-question').style.display = currentQuestionIndex === quizData.length - 1 ? 'none' : 'block';
    document.getElementById('submit-quiz').style.display = currentQuestionIndex === quizData.length - 1 ? 'block' : 'none';

    timeLeft = TIME_PER_QUESTION;
    startTimer();
}

// Handle navigation between questions
document.getElementById('next-question').addEventListener('click', () => {
    currentQuestionIndex++;
    renderQuestion();
});

document.getElementById('previous-question').addEventListener('click', () => {
    currentQuestionIndex--;
    renderQuestion();
});

// Start the timer
function startTimer() {
    const timerElement = document.getElementById('time');
    timer = setInterval(() => {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        timerElement.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        timeLeft--;

        if (timeLeft < 0) {
            clearInterval(timer);
            if (currentQuestionIndex < quizData.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
            } else {
                submitQuiz();
            }
        }
    }, 1000);
}

// Submit the quiz and evaluate results
document.getElementById('submit-quiz').addEventListener('click', submitQuiz);

function submitQuiz() {
    clearInterval(timer);

    let correctAnswers = 0;
    const resultsContainer = document.getElementById('results');
    resultsContainer.innerHTML = '';

    quizData.forEach(question => {
        const userAnswer = userAnswers[question.id];
        const isCorrect = userAnswer === question.correctAnswer;
        if (isCorrect) {
            correctAnswers++;
        }

        resultsContainer.innerHTML += `
            <div class="result-item ${isCorrect ? 'correct' : 'incorrect'}">
                <h3>${question.question}</h3>
                <p><strong>Correct Answer:</strong> ${question.correctAnswer}</p>
                <p><strong>Your Answer:</strong> ${userAnswer || 'Not Answered'}</p>
            </div>
        `;
    });

    // Save results to Firestore
    saveResultsToFirestore(correctAnswers, quizData.length);

    document.getElementById('quiz-container').style.display = 'none';
    document.getElementById('result-container').style.display = 'block';
    document.getElementById('view-results').style.display = 'block';
}

function saveResultsToFirestore(score, total) {
    const user = auth.currentUser;
    if (user) {
        addDoc(collection(db, 'userResults'), {
            userId: user.uid,
            email: user.email,
            score: score,
            total: total,
            timestamp: serverTimestamp()
        });
    }
}

// Retry the quiz
document.getElementById('retry-quiz').addEventListener('click', () => {
    startQuiz();
    document.getElementById('result-container').style.display = 'none';
    document.getElementById('quiz-container').style.display = 'block';
});

// View results
document.getElementById('view-results').addEventListener('click', async () => {
    const resultsContainer = document.getElementById('admin-results');
    resultsContainer.innerHTML = '';
    const querySnapshot = await getDocs(collection(db, 'userResults'));
    querySnapshot.forEach(async doc => {
        const data = doc.data();
        const userDoc = await getDocs(collection(db, 'users'));
        const userData = userDoc.docs.find(user => user.id === data.userId)?.data();
        resultsContainer.innerHTML += `
            <div class="admin-result-item">
                <h3>Email: ${data.email}</h3>
                <p>Name: ${userData ? userData.name : 'N/A'}</p>
                <p>Score: ${data.score} / ${data.total}</p>
                <p>Timestamp: ${new Date(data.timestamp.seconds * 1000).toLocaleString()}</p>
            </div>
        `;
    });
});

// Auto-login on page load if user is already logged in
onAuthStateChanged(auth, user => {
    if (user) {
        handleUserRedirect(user);
    } else {
        document.getElementById('auth-container').style.display = 'block';
        document.getElementById('quiz-container').style.display = 'none';
        document.getElementById('result-container').style.display = 'none';
        document.getElementById('admin-dashboard').style.display = 'none';
        document.getElementById('view-results').style.display = 'none';
    }
});
